/*
 * bbcode.js -- client-side bbcode-library
 * Copyright (C) 2012 hackyourlife <root@hackyourlife.tk>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 * 
 */

eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('v y(a,b,c,d){4.6=a;4.9=b;4.G=c;4.U=d;4.7=t M();4.z=0;4.1v=\'\';4.1w=\'\'}v A(a){4.H=a;4.I=x}A.C.1x=v(a){4.I=a};A.C.1y=v(a){2 b=4.13(a);8 4.P(b)};A.C.1z=v(a){2 b=4.13(a);8 4.1a(b)};A.C.13=v(a,b){2 c=4.1b(a);2 d=t M();w(2 e D 4.H)d[e]=0;2 f=4.14(c,0,t y(\'<S>\'),d);8 4.V(f)};A.C.Q=v(a){3(a.6==\'<5>\')8 a.9;2 b=\'\';w(2 c D a.7){b+=4.Q(a.7[c])}8 a.G+b+a.15};A.C.1c=v(a){2 b=\'\';w(2 c D a.7)b+=4.Q(a.7[c]);8 b};A.C.V=v(a){3(a.6==\'<5>\')8 a;2 b=W;2 c=4.H[a.6];2 d=c.7.1d(\',\');3((a.9==x)&&(c.1e!=x))d=c.1e.1d(\',\');2 e=t M();w(2 f D d)e[d[f]]=W;2 g=t y(a.6,a.9,a.G);g.7=t M();g.z=0;w(2 f D a.7){2 h=4.V(a.7[f]);3(h==x){2 i=a.7[f];g.7[g.z++]=t y(\'<5>\',i.G,\'<5>\');w(2 j D i.7){2 k=4.V(i.7[j]);3(e[k.6]!=W){3(e[\'<5>\'])3(c.16!=\'17\')g.7[g.z++]=t y(\'<5>\',4.Q(i.7[j]),\'<5>\');r{b=N;O}r{3(!((k.6==\'<5>\')&&(k.9.J().K==0))){b=N;O}}}r g.7[g.z++]=k}g.7[g.z++]=t y(\'<5>\',i.15,\'<5>\');1A}3(e[h.6]!=W){3(e[\'<5>\'])3(c.16!=\'17\')g.7[g.z++]=t y(\'<5>\',4.Q(a.7[f]),\'<5>\');r{b=N;O}r{3(!((h.6==\'<5>\')&&(h.9.J().K==0))){b=N;O}}}r g.7[g.z++]=h}3(c.1f){2 l=\'\';2 m=g.7;w(2 f D m){2 n=m[f];3(n.6==\'<5>\'){3((c.I!=N)&&4.I)l+=4.X(n.9);r l+=R(n.9)}r l+=4.P(n)}3(c.J){l=Y(l)}3(!c.1f(l))8 x}3((c.1g==\'1h\')&&(c.1i)){2 l=\'\';2 o=\'\';2 m=g.7;w(2 f D m){2 n=m[f];3(n.6==\'<5>\'){3((c.I!=N)&&4.I)l+=4.X(n.9);r l+=R(n.9);o+=h.9}r l+=4.P(n)}3(c.J){l=Y(l);o=o.J()}3(c.Z)l=c.Z(l,g.9);2 p=g.9;3(g.9==x)p=c.1j;3((p!=x)&&(p.E(\'{L}\')!=-1))p=p.u(/{L}/g,10(l));3(!c.1i(p)){8 x}}2 h=g;3(!b){3(e[\'<5>\']&&c.16!=\'17\'){2 q=4.1c(a);h.7=t M();h.z=0;h.7[h.z++]=t y(\'<5>\',q,\'<5>\');8 h}r{2 q=4.Q(a);h.6=\'<5>\';h.9=q;8 h}}8 h};A.C.14=v(a,b,c,d,e){2 f=t M();w(2 g D d)f[g]=d[g];2 h=-1;2 j=\'\';2 k=\'\';2 l=4.H[c.6].1B;3(l){w(2 i=b;i<a.K;i++){3((a[i].6==c.6)&&(a[i].U==\'11\')){h=i;j=a[i].6;k=a[i].G;O}}}r{w(2 i=b;i<a.K;i++){3(a[i].U==\'11\')f[a[i].6]--;r f[a[i].6]++;3((f[c.6]<d[c.6])||((e!=x)&&(f[e]<d[e]))){h=i;j=a[i].6;k=a[i].G;O}}}3(((h==-1)||(j!=c.6))&&(c.6!=\'<S>\')&&!4.H[c.6].1C){c.6=\'<5>\';c.9=c.G;c.18=0;8 c}3(h==-1)h=a.K;3(l){2 m=\'\';w(2 i=b;i<h;i++)m+=(a[i].6==\'<5>\')?a[i].9:a[i].G;c.7[c.z++]=t y(\'<5>\',m,\'<5>\')}r{w(2 i=b;i<h;i++){3(a[i].6!=\'<5>\'){3(a[i].U==\'11\'){c.7[c.z++]=t y(\'<5>\',a[i].G,\'<5>\')}r{d[a[i].6]++;2 n=4.14(a,i+1,a[i],d,c.6);d[a[i].6]--;i+=n.18;c.7[c.z++]=n}}r c.7[c.z++]=a[i]}}3(h!=-1)c.15=k;c.18=h-b+1;8 c};v 1k(a){2 b=\'\';w(2 i=0;i<a.K;i++){2 c=a.19(i);1D(c){B\'/\':B\'[\':B\']\':B\'(\':B\')\':B\':\':B\'.\':B\'\\\\\':B\'{\':B\'}\':B\'?\':B\'*\':B\'|\':b+=\'\\\\\'+c;O;1E:b+=c}}8 b}A.C.X=v(a){a=R(a);w(2 b D 4.I)a=a.u(t 1F(1k(R(b)),\'g\'),\'<1l 1G="\'+4.I[b]+\'" G="\'+b+\'" />\');8 a};A.C.P=v(a){3(a.6==\'<5>\')8 a.9;2 b=4.H[a.6];2 c=\'\';2 d=\'\';2 e=a.7;w(2 f D e){2 g=e[f];3(g.6==\'<5>\'){3((b.I!=N)&&4.I)c+=4.X(g.9);r c+=R(g.9);d+=g.9}r c+=4.P(g)}3(b.J){c=Y(c);d=d.J()}3(b.Z)c=b.Z(c,a.9);3(a.6!=\'<S>\'){2 h=a.9;3((b.1g==\'1h\')&&(a.9==x))h=b.1j;3((h!=x)&&(h.E(\'{L}\')!=-1))h=h.u(/{L}/g,10(c));3((h!=x)&&(b.1m))h=b.1m(h);2 i=b.1H;3(i.E(\'{12}\')!=-1)i=i.u(/{12}/g,h);3(i.E(\'{L}\')!=-1)i=i.u(/{L}/g,c);2 j=b.1I;3(j.E(\'{12}\')!=-1)j=j.u(/{12}/g,h);3(j.E(\'{L}\')!=-1)j=j.u(/{L}/g,c);8 i+c+j}r 8 c};A.C.1a=v(a){2 b=4.P(a);8 1n(b).K};A.C.1b=v(a){a=a.J();2 b=t M();2 d=0;2 e=\'\';w(2 i=0;i<a.K;i++){2 c=a.19(i);3(c==\'[\'){2 f=a.1o(i).E(\']\');3(i<(a.K-1)){2 g=a.1o(i+1).E(\'[\');3((g!=-1)&&(g<f))f=-1}3(f==-1){e+=c}r{2 h=a.F(i+1,f-1);3(h.19(0)==\'/\'){h=h.F(1);3(4.H[\'<S>\'].1p)h=h.1q();3(4.H[h]!=x){3(e!=\'\')b[d++]=t y(\'<5>\',e,\'<5>\');b[d++]=t y(h,x,a.F(i,f+1),\'11\');e=\'\'}r e+=a.F(i,f+1)}r{2 j=x;2 k=h.E(\'=\');2 l=h.E(\' \');3((l!=-1)&&(l<k)){2 m=h.F(0,l);2 n=h.F(k);2 o=n.E(\' \');3((o!=-1)&&(k==(l+1))){j=n.F(o+1)}h=m;k=-1}3(k!=-1){j=h.F(k+1);h=h.F(0,k)}3(4.H[\'<S>\'].1p)h=h.1q();3(4.H[h]!=x){3(e!=\'\')b[d++]=t y(\'<5>\',e,\'<5>\');b[d++]=t y(h,j,a.F(i,f+1),\'1J\');e=\'\'}r e+=a.F(i,f+1)}i+=f}}r{e+=c}}3(e!=\'\')b[d++]=t y(\'<5>\',e,\'<5>\');8 b};v R(a){8 a.u(/&/g,\'&1r;\').u(/</g,\'&1s;\').u(/>/g,\'&1t;\').u(/\\"/g,\'&1u;\').u(/\\n/g,\'<T />\')}v 10(a){8 a.u(/<T\\s?\\/?>/g,\'\\n\').u(/&1u;/g,\'"\').u(/&1t;/g,\'>\').u(/&1s;/g,\'<\').u(/&1r;/g,\'&\')}v Y(a){8 a.u(/<T\\s?\\/?>/g,\'\\n\').J().u(/\\n/g,\'<T />\')}v 1n(a){8 10(a.u(/<T\\s?\\/?>/g,\'\\n\').u(/<1l [^>].*?>/g,\' \').u(/<[^>].*?>/g,\'\'))}',62,108,'||var|if|this|text|name|childs|return|param||||||||||||||||||else||new|replace|function|for|undefined|BBTag|next|BBFormatter|case|prototype|in|indexOf|substr|alt|rules|smilies|trim|length|CONTENT|Array|false|break|writeTree|node2text|htmlformat|root|br|flags|validateTree|true|replaceSmilies|htmltrim|content_handler|htmlunformat|close|PARAM|buildTree|createTree|endalt|oninvalid|all|sub|charAt|countVisibleChars|parseNodes|childs2text|split|childs_noarg|content_validator|type|optarg|param_validator|default_arg|regexformat|img|param_handler|html2plain|substring|ignore_case|toLowerCase|amp|lt|gt|quot|startTag|endTag|setSmilies|format|charCount|continue|noparse|leaveopen|switch|default|RegExp|src|open_tag|close_tag|open'.split('|'),0,{}))

/*
 * bbcode.js -- client-side bbcode-library
 * Copyright (C) 2012 hackyourlife <root@hackyourlife.tk>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 * 
 */

eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('v y(a,b,c,d){4.5=a;4.9=b;4.G=c;4.T=d;4.7=t M();4.z=0;4.1t=\'\';4.1u=\'\'}v A(a){4.K=a;4.H=x}A.C.1v=v(a){4.H=a};A.C.1w=v(a){2 b=4.12(a);8 4.P(b)};A.C.1x=v(a){2 b=4.12(a);8 4.19(b)};A.C.12=v(a,b){2 c=4.1a(a);2 d=t M();w(2 e D 4.K)d[e]=0;2 f=4.13(c,0,t y(\'<14>\'),d);8 4.U(f)};A.C.Q=v(a){3(a.5==\'<6>\')8 a.9;2 b=\'\';w(2 c D a.7){b+=4.Q(a.7[c])}8 a.G+b+\'[/\'+a.5+\']\'};A.C.1b=v(a){2 b=\'\';w(2 c D a.7)b+=4.Q(a.7[c]);8 b};A.C.U=v(a){3(a.5==\'<6>\')8 a;2 b=V;2 c=4.K[a.5];2 d=c.7.1c(\',\');3((a.9==x)&&(c.1d!=x))d=c.1d.1c(\',\');2 e=t M();w(2 f D d)e[d[f]]=V;2 g=t y(a.5,a.9,a.G);g.7=t M();g.z=0;w(2 f D a.7){2 h=4.U(a.7[f]);3(h==x){2 i=a.7[f];g.7[g.z++]=t y(\'<6>\',i.G,\'<6>\');w(2 j D i.7){2 k=4.U(i.7[j]);3(e[k.5]!=V){3(e[\'<6>\'])3(c.15!=\'16\')g.7[g.z++]=t y(\'<6>\',4.Q(i.7[j]),\'<6>\');r{b=N;O}r{3(!((k.5==\'<6>\')&&(k.9.I().J==0))){b=N;O}}}r g.7[g.z++]=k}g.7[g.z++]=t y(\'<6>\',i.1e,\'<6>\');1y}3(e[h.5]!=V){3(e[\'<6>\'])3(c.15!=\'16\')g.7[g.z++]=t y(\'<6>\',4.Q(a.7[f]),\'<6>\');r{b=N;O}r{3(!((h.5==\'<6>\')&&(h.9.I().J==0))){b=N;O}}}r g.7[g.z++]=h}3(c.1f){2 l=\'\';2 m=g.7;w(2 f D m){2 n=m[f];3(n.5==\'<6>\'){3((c.H!=N)&&4.H)l+=4.W(n.9);r l+=R(n.9)}r l+=4.P(n)}3(c.I){l=X(l)}3(!c.1f(l))8 x}3((c.1g==\'1h\')&&(c.1i)){2 l=\'\';2 o=\'\';2 m=g.7;w(2 f D m){2 n=m[f];3(n.5==\'<6>\'){3((c.H!=N)&&4.H)l+=4.W(n.9);r l+=R(n.9);o+=h.9}r l+=4.P(n)}3(c.I){l=X(l);o=o.I()}3(c.Y)l=c.Y(l,g.9);2 p=g.9;3(g.9==x)p=c.1j;3((p!=x)&&(p.E(\'{L}\')!=-1))p=p.u(/{L}/g,Z(l));3(!c.1i(p)){8 x}}2 h=g;3(!b){3(e[\'<6>\']&&c.15!=\'16\'){2 q=4.1b(a);h.7=t M();h.z=0;h.7[h.z++]=t y(\'<6>\',q,\'<6>\');8 h}r{2 q=4.Q(a);h.5=\'<6>\';h.9=q;8 h}}8 h};A.C.13=v(a,b,c,d,e){2 f=t M();w(2 g D d)f[g]=d[g];2 h=-1;2 j=\'\';2 k=\'\';2 l=4.K[c.5].1z;3(l){w(2 i=b;i<a.J;i++){3((a[i].5==c.5)&&(a[i].T==\'10\')){h=i;j=a[i].5;k=a[i].G;O}}}r{w(2 i=b;i<a.J;i++){3(a[i].T==\'10\')f[a[i].5]--;r f[a[i].5]++;3((f[c.5]<d[c.5])||((e!=x)&&(f[e]<d[e]))){h=i;j=a[i].5;k=a[i].G;O}}}3(((h==-1)||(j!=c.5))&&(c.5!=\'<14>\')&&!4.K[c.5].1A){c.5=\'<6>\';c.9=c.G;c.17=0;8 c}3(h==-1)h=a.J;3(l){2 m=\'\';w(2 i=b;i<h;i++)m+=(a[i].5==\'<6>\')?a[i].9:a[i].G;c.7[c.z++]=t y(\'<6>\',m,\'<6>\')}r{w(2 i=b;i<h;i++){3(a[i].5!=\'<6>\'){3(a[i].T==\'10\'){c.7[c.z++]=t y(\'<6>\',a[i].G,\'<6>\')}r{d[a[i].5]++;2 n=4.13(a,i+1,a[i],d,c.5);d[a[i].5]--;i+=n.17;c.7[c.z++]=n}}r c.7[c.z++]=a[i]}}3(h!=-1)c.1e=k;c.17=h-b+1;8 c};v 1k(a){2 b=\'\';w(2 i=0;i<a.J;i++){2 c=a.18(i);1B(c){B\'/\':B\'[\':B\']\':B\'(\':B\')\':B\':\':B\'.\':B\'\\\\\':B\'{\':B\'}\':B\'?\':B\'*\':B\'|\':b+=\'\\\\\'+c;O;1C:b+=c}}8 b}A.C.W=v(a){a=R(a);w(2 b D 4.H)a=a.u(t 1D(1k(R(b)),\'g\'),\'<1l 1E="\'+4.H[b]+\'" G="\'+b+\'" />\');8 a};A.C.P=v(a){3(a.5==\'<6>\')8 a.9;2 b=4.K[a.5];2 c=\'\';2 d=\'\';2 e=a.7;w(2 f D e){2 g=e[f];3(g.5==\'<6>\'){3((b.H!=N)&&4.H)c+=4.W(g.9);r c+=R(g.9);d+=g.9}r c+=4.P(g)}3(b.I){c=X(c);d=d.I()}3(b.Y)c=b.Y(c,a.9);3(a.5!=\'<14>\'){2 h=a.9;3((b.1g==\'1h\')&&(a.9==x))h=b.1j;3((h!=x)&&(h.E(\'{L}\')!=-1))h=h.u(/{L}/g,Z(c));3((h!=x)&&(b.1m))h=b.1m(h);2 i=b.1F;3(i.E(\'{11}\')!=-1)i=i.u(/{11}/g,h);3(i.E(\'{L}\')!=-1)i=i.u(/{L}/g,c);2 j=b.1G;3(j.E(\'{11}\')!=-1)j=j.u(/{11}/g,h);3(j.E(\'{L}\')!=-1)j=j.u(/{L}/g,c);8 i+c+j}r 8 c};A.C.19=v(a){2 b=4.P(a);8 1n(b).J};A.C.1a=v(a){a=a.I();2 b=t M();2 d=0;2 e=\'\';w(2 i=0;i<a.J;i++){2 c=a.18(i);3(c==\'[\'){2 f=a.1o(i).E(\']\');3(i<(a.J-1)){2 g=a.1o(i+1).E(\'[\');3((g!=-1)&&(g<f))f=-1}3(f==-1){e+=c}r{2 h=a.F(i+1,f-1);3(h.18(0)==\'/\'){h=h.F(1);3(4.K[h]!=x){3(e!=\'\')b[d++]=t y(\'<6>\',e,\'<6>\');b[d++]=t y(h,x,a.F(i,f+1),\'10\');e=\'\'}r e+=a.F(i,f+1)}r{2 j=x;2 k=h.E(\'=\');2 l=h.E(\' \');3((l!=-1)&&(l<k)){2 m=h.F(0,l);2 n=h.F(k);2 o=n.E(\' \');3((o!=-1)&&(k==(l+1))){j=n.F(o+1)}h=m;k=-1}3(k!=-1){j=h.F(k+1);h=h.F(0,k)}3(4.K[h]!=x){3(e!=\'\')b[d++]=t y(\'<6>\',e,\'<6>\');b[d++]=t y(h,j,a.F(i,f+1),\'1H\');e=\'\'}r e+=a.F(i,f+1)}i+=f}}r{e+=c}}3(e!=\'\')b[d++]=t y(\'<6>\',e,\'<6>\');8 b};v R(a){8 a.u(/&/g,\'&1p;\').u(/</g,\'&1q;\').u(/>/g,\'&1r;\').u(/\\"/g,\'&1s;\').u(/\\n/g,\'<S />\')}v Z(a){8 a.u(/<S\\s?\\/?>/g,\'\\n\').u(/&1s;/g,\'"\').u(/&1r;/g,\'>\').u(/&1q;/g,\'<\').u(/&1p;/g,\'&\')}v X(a){8 a.u(/<S\\s?\\/?>/g,\'\\n\').I().u(/\\n/g,\'<S />\')}v 1n(a){8 Z(a.u(/<S\\s?\\/?>/g,\'\\n\').u(/<1l [^>].*?>/g,\' \').u(/<[^>].*?>/g,\'\'))}',62,106,'||var|if|this|name|text|childs|return|param||||||||||||||||||else||new|replace|function|for|undefined|BBTag|next|BBFormatter|case|prototype|in|indexOf|substr|alt|smilies|trim|length|rules|CONTENT|Array|false|break|writeTree|node2text|htmlformat|br|flags|validateTree|true|replaceSmilies|htmltrim|content_handler|htmlunformat|close|PARAM|buildTree|createTree|root|oninvalid|all|sub|charAt|countVisibleChars|parseNodes|childs2text|split|childs_noarg|endalt|content_validator|type|optarg|param_validator|default_arg|regexformat|img|param_handler|html2plain|substring|amp|lt|gt|quot|startTag|endTag|setSmilies|format|charCount|continue|noparse|leaveopen|switch|default|RegExp|src|open_tag|close_tag|open'.split('|'),0,{}))
